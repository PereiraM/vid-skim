<!DOCTYPE html>
<html>
<head>

<title><%= @transcript.title %></title>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<script src="http://www.google.com/jsapi" type="text/javascript"></script>
  <script type="text/javascript">
    google.load("swfobject", "2.1");
    google.load("jquery", "1");  
    
  </script>
  <script src="javascripts/vid_skim.js" type="text/javascript"></script>
  <link href="stylesheets/vid_skim.css" media="screen" rel="stylesheet" type="text/css" />
</head>
<body>



  <div id="vid-tabs">
    <ul>
      <%# This means that divisions can only be one word, no special chars, grrr%>
    <% @transcript.divisions.each_pair do |x, d| %><li><a href="#" id="tab-<%=d.name%>"><%= d.name %></a></li><% end %>
    </ul>
  </div>
  
  <div id="viewer" class="clearfix">

  	<div id="timeline">
  	  <div class="scrubber"></div>
  	  <div class="position"></div>    
    </div>
    <div id="vid-nav">
      <%["Next", "Previous"].each do |i| %>
        <a href="" class="<%= i.downcase %>"><%= i%></a>
      <%end%>
    </div>
    

    <div id="player_container">
      <div id="ytapiplayer">
        You need Flash player 8+ and JavaScript enabled to view this video.
      </div>
    </div>
    <div id="trans">
      <div id="extra"></div>
    </div>
    <div id="annotation"></div>
    
  </div>
  <div id="rail">
    <% @transcript.divisions.each_pair do |x, d|%>
    <div class="<%= Inflector.parameterize(x, '') %>">
    <p><strong><%= x %></strong></p>
    <ul>
      <% d.unique_entries_by_title.each do |e| %>
        <li><a class="index <%= Inflector.parameterize(e.title, '') %>" href="#<%= e.range.to_seconds(:low) %>" class="index"><%= e.title %></a></li>
      <% end %>
    </ul>
    </div>
    <%end%>
  </div>
</div>



<script type="text/javascript">
data = <%= @transcript.to_json %>



  var params = { allowScriptAccess: "always" };
  var atts = { id: "ytplayer" };
  swfobject.embedSWF("http://www.youtube.com/v/<%= @transcript.youtube_id %>?enablejsapi=1&playerapiid=myytplayer", 
                     "ytapiplayer", "375", "305", "8", null, null, params, atts);
  
  
$.preloadImages(
'http://www.propublica.org/images/tubes/prev.jpg',
'http://www.propublica.org/images/tubes/next.jpg',
'http://www.propublica.org/images/tubes/prev-hover.jpg',
'http://www.propublica.org/images/tubes/next-hover.jpg'
);
    

  var trans = new Transcript('#timeline', '#trans', '#extra', '#vid-nav','#vid-tabs', '#rail', '#viewer', window.location);
  trans.setData(data, "<%= @transcript.default %>")

  
  
                     
  function onYouTubePlayerReady(playerId) {
  
    var ytplayer = document.getElementById('ytplayer'); // wow, ie6 I hate you.    
    trans.setPlayer(ytplayer);
    
    trans.seek(trans.hashSeconds);

    trans.setBounds(<%= @transcript.duration %>);
    setInterval(updateytplayerInfo, 250);  
    trans.initted = true;
  }
  
  
  function updateytplayerInfo() {
    trans.draw(trans.player.getCurrentTime());
  }


</script>


