<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: README_FOR_APP</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>README_FOR_APP</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>doc/README_FOR_APP
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Sep 21 12:55:06 -0400 2009</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>Video Skimmer</h1>
<p>
<em>A transcription presentation layer for those of us who would rather use
YouTube as our CDN and mass audience provider.</em>
</p>
<h3>How it Works</h3>
<p>
There are two ruby classes, <a href="../../classes/Tube.html">Tube</a> and
<a href="../../classes/Transcript.html">Transcript</a>, that build
functionality from a yaml and a json file, respectively. A <a
href="../../classes/Tube.html">Tube</a> instance contains the basic data
for formatting of the page, and contains a reference to a <a
href="../../classes/Transcript.html">Transcript</a> instance which parses
and sorts a json file.
</p>
<p>
The json file (see kwalify schema in <tt>config/tubes/schema.json</tt>)
contains one or more divisions of the content each with timecoded entries,
which sync with the video on YouTube.
</p>
<p>
Most of the view functionality and look is built by application.js, which
defines a javascript class called transcript. The transcript object builds
the timeline from the json defined in
<tt>config/tube/transcript/YOUTUBE_ID.json</tt> and served through a rails
view. Most of the UI magic happens by treating the youtube player as the
engine for every UI change. That is, the transcript instance needs to check
the current player&#8216;s time every couple hundred milliseconds and
redraw and update the UI.
</p>
<h3>Modifying the View</h3>
<p>
The javascript pretty much requires that your html reads like this:
</p>
<pre>
  &lt;div id=&quot;timeline&quot;&gt;
    &lt;div class=&quot;scrubber&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;position&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;
  &lt;div id=&quot;vid-nav&quot;&gt;
    &lt;%[&quot;Next&quot;, &quot;Previous&quot;].each do |i| %&gt;
      &lt;a href=&quot;&quot; class=&quot;&lt;%= i.downcase %&gt;&quot;&gt;&lt;%= i%&gt;&lt;/a&gt;
    &lt;%end%&gt;
  &lt;/div&gt;

  &lt;div id=&quot;player_container&quot;&gt;
    &lt;div id=&quot;ytapiplayer&quot;&gt;
      You need Flash player 8+ and JavaScript enabled to view this video.
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div id=&quot;trans&quot;&gt;
    &lt;div id=&quot;extra&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;
  &lt;div id=&quot;annotation&quot;&gt;&lt;/div&gt;

  &lt;/div&gt;
  &lt;div id=&quot;rail&quot;&gt;
    &lt;% @tube.transcript.divisions.each_pair do |x, d|%&gt;
    &lt;div class=&quot;&lt;%= x.parameterize('').downcase %&gt;&quot;&gt;
    &lt;p&gt;&lt;strong&gt;&lt;%= x %&gt;&lt;/strong&gt;&lt;/p&gt;
    &lt;ul&gt;
      &lt;% d.unique_entries_by_title.each do |e| %&gt;
        &lt;li&gt;
          &lt;a class=&quot;index &lt;%= e.title.parameterize('').downcase %&gt;&quot;
             href=&quot;#&lt;%= e.range.to_seconds(:low) %&gt;&quot; class=&quot;index&quot;&gt;
          &lt;%= e.title %&gt;
         &lt;/a&gt;
         &lt;/li&gt;
      &lt;% end %&gt;
    &lt;/ul&gt;
    &lt;/div&gt;
    &lt;%end%&gt;
  &lt;/div&gt;
</pre>
<p>
And the constructor for the JS <a
href="../../classes/Transcript.html">Transcript</a> class takes each id as
an argument:
</p>
<pre>
  var trans = new Transcript('#timeline', '#trans', '#extra',
              '#vid-nav','#vid-tabs', '#rail', '#viewer', window.location);
</pre>
<p>
So your best bet for changing the way it looks is to modify the css. A
warning: most of the timeline css is pretty specific so modifying the child
selectors there can mess with the layout in various browsers.
</p>
<p>
You also have to load the json into the transcript instance like so:
</p>
<pre>
  $(document).ready(function (){
    $.getJSON(trans.baseURL + &quot;.json&quot;, function (data, textStatus) {
      trans.setData(data, &quot;&lt;%=@tube.default%&gt;&quot;);
    });
  });
</pre>
<p>
And finally hook into the YouTube player with:
</p>
<pre>
  function onYouTubePlayerReady(playerId) {

    var ytplayer = document.getElementById('ytplayer');
    //caches the player so transcript can access it from within the instance
    trans.setPlayer(ytplayer);

    trans.seek(trans.hashSeconds);

    // @tube.duration is a required api call so we can map the width of the
    // timeline to the length of the video
    trans.setBounds(&lt;%= @tube.duration %&gt;);
    setInterval(updateytplayerInfo, 250);
    trans.initted = true;
  }

  function updateytplayerInfo() {
    trans.draw(trans.player.getCurrentTime());
  }
</pre>
<p>
<tt>updateytplayerInfo()</tt> is the linkage between the javascript and the
UI, so make sure the browser is calling it at some regular interval.
</p>
<p>
One of the future improvements to this layout is to refactor some of it,
most notably move the timeline into js templates, so this section will most
likely change.
</p>
<h3>Required Libraries</h3>
<ul>
<li>Nokogiri - for parsing the google data feed. Necessary to find out the
duration of a given video.

</li>
</ul>
<h3>Wish List (Features TK)</h3>
<ul>
<li><a href="../../classes/Admin.html">Admin</a> Section: the current plan for
the admin area requires that it run only in development environment,
because, for such a thin app, it doesn&#8216;t make much sense to have a
forward facing security risk. There should also be a cap task that sends
the transcripts to the production server.

</li>
<li>Use Javascript templates and models: it would be nice to separate the model
definition and use template code in the Javascript. Right now the <a
href="../../classes/Transcript.html">Transcript</a> object is really messy,
and for readability and maintainability concerns it would be best to
separate the transcript accessor/convenience methods, event listeners and
to create js templates.

</li>
<li>Benchmark/load test the javascript in various browsers.

</li>
<li>A lot more specs/tests.

</li>
</ul>

    </div>


   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>